(function(){$(function(){var e,t,n,o,r,a,s,i,u,l,c,d,p,y,h;return l=$(".log"),i=$(".user_input"),p=$(".closest_schools table"),u=c=h=null,e="AIzaSyBxpvIsI9BxdiKRXF7DjZGCKT3mGadMqt8",t="https://maps.googleapis.com/maps/api/geocode/json?",d={},r=function(){var n,r;return l.text("Please allow the browser to access your current location so I can help you search for schools!"),window.navigator.geolocation?(r=function(n){var r,a;return u=n.coords.latitude,c=n.coords.longitude,r=""+u+","+c,a=""+t+"latlng="+r+"&result_type=postal_code&sensor=true&key="+e,l.text("One moment please. I am looking up your current zip code!"),$.getJSON(a,function(e){return"OK"===e.status?(h=e.results[0].address_components[0].long_name,l.text("Your zip code is "+h+"!"),o()):(i.fadeIn(1500),l.text("Sorry, there was an error in retrieving your zip code. Please enter it manually below."))})},n=function(e){return 1===e.code?(i.fadeIn(1500),l.text("You can enter your zip code manually below!")):2===e.code?(i.fadeIn(1500),l.text("Sorry, but your zipcode is unavailable! Try entering it manually below!")):3===e.code?(i.fadeIn(1500),l.text("The Geolocation feature of your device has timed out! Please enter your zip code manually below!")):void 0},l.text("One moment please. I am looking up your current location."),navigator.geolocation.getCurrentPosition(r,n)):(i.fadeIn(1500),l.text("Geolocation is not supported by your device! Please enter your zip code manually below.")),i.on("keypress",function(n){var r;return 13===n.which?(h=i.val(),isNaN(h)||5!==h.length?(h=null,l.text("Please enter a valid zipcode!")):(r=""+t+"address="+h+"&result_type=postal_code&sensor=false&key="+e,l.text("One moment please. I am looking up your current latitude and longitude!"),$.getJSON(r,function(e){return"OK"===e.status?(l.text("Your zip code is "+h+"!"),u=e.results[0].geometry.location.lat,c=e.results[0].geometry.location.lng,i.fadeOut(1500),o()):l.text("Sorry, there was an error in determining your latitude and longitude. Please try again later.")}))):void 0})},o=function(){var e;return e="/data/schools.json",$.ajax({type:"GET",dataType:"json",url:e,success:function(e){return d=e,n(3)}})},n=function(e){var t,n,o,r,s;for(o=0,s=d.length;s>o;o++)n=d[o],n.haversine=a(u,c,n.lat,n.lon);for(d.sort(function(e,t){return e.haversine-t.haversine}),l.empty(),l.fadeOut(1500),t=r=0;e>=0?e>r:r>e;t=e>=0?++r:--r)p.append("<tr>\n   <td>"+d[t].name+"</td>\n   <td>"+d[t].street+"<br>"+d[t].city+", "+d[t].state+" "+d[t].zip+"</td>\n   <td>"+parseInt(d[t].haversine)+" miles</td>\n</tr>");return p.parent().fadeIn(1500)},y=function(e){return e*Math.PI/180},a=function(e,t,n,o){var r,a,s,i,u;return u=3958.75587,s=y(n-e),i=y(o-t),e=y(e),n=y(n),r=Math.sin(s/2)*Math.sin(s/2)+Math.sin(i/2)*Math.sin(i/2)*Math.cos(e)*Math.cos(n),a=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),u*a},(s=function(){return r()})()})}).call(this);